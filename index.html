<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>القيم</title>
    <link rel="stylesheet" href="index.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Aref+Ruqaa:wght@400;700&family=Amiri:wght@400;700&family=Cairo:wght@400;700&family=Noto+Sans+Arabic:wght@400;700&family=Tajawal:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#ffffff" />
    <script type="importmap">
      {
        "imports": {
          "@google/genai": "https://esm.sh/@google/genai@^1.15.0"
        }
      }
    </script>
  </head>
  <body>
    <div id="app-layout">
      <aside id="sidebar">
        <div class="sidebar-header">
          <button id="new-chat-button" class="sidebar-button">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 0 1 1 1v5h5a1 1 0 1 1 0 2h-5v5a1 1 0 1 1-2 0v-5H4a1 1 0 1 1 0-2h5V4a1 1 0 0 1 1-1Z" clip-rule="evenodd" /></svg>
            <span>محادثة جديدة</span>
          </button>
          <button id="sidebar-toggle" class="sidebar-button icon-button" aria-label="طي اللوحة الجانبية">
             <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="icon-collapse"><path fill-rule="evenodd" d="M3 10a.75.75 0 0 1 .75-.75h10.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 10Z" clip-rule="evenodd" /><path fill-rule="evenodd" d="M11.53 5.47a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 1 1-1.06-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd" /><path fill-rule="evenodd" d="M6.22 13.47a.75.75 0 0 1 1.06 0l4.25-4.25a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0Z" clip-rule="evenodd" /></svg>
             <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="icon-expand"><path fill-rule="evenodd" d="M17 10a.75.75 0 0 1-.75.75H5.75a.75.75 0 0 1 0-1.5h10.5A.75.75 0 0 1 17 10Z" clip-rule="evenodd" /><path fill-rule="evenodd" d="M8.47 14.53a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0Z" clip-rule="evenodd" /><path fill-rule="evenodd" d="M13.78 6.53a.75.75 0 0 1-1.06 0L8.47 10.78a.75.75 0 1 1-1.06-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd" /></svg>
          </button>
        </div>
        <div class="sidebar-content">
           <div class="sidebar-section">
              <details class="history-category" open>
                <summary class="history-category-title">الموسوعة الحديثية</summary>
                <div class="sidebar-encyclopedia-content">
                  <form id="encyclopedia-search-form" class="sidebar-form">
                    <div class="encyclopedia-search-input-wrapper">
                      <input type="text" id="encyclopedia-search-input" placeholder="ابحث في الدرر السنية...">
                      <button type="submit" id="encyclopedia-search-button" aria-label="بحث">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11ZM2 9a7 7 0 1 1 12.452 4.391l3.328 3.329a.75.75 0 1 1-1.06 1.06l-3.329-3.328A7 7 0 0 1 2 9Z" clip-rule="evenodd"></path></svg>
                      </button>
                    </div>
                  </form>
                  <div id="encyclopedia-results-container">
                    <div id="encyclopedia-results"></div>
                  </div>
                </div>
              </details>
            </div>
           <div class="sidebar-section">
                <p class="history-title">إعدادات</p>
                <div id="font-controls-container">
                    <div class="font-control-group">
                        <span class="font-control-label">حجم الخط</span>
                        <div id="font-size-control">
                            <button id="decrease-font" aria-label="تصغير الخط">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M6.5 9.25a.75.75 0 0 0 0 1.5h7a.75.75 0 0 0 0-1.5h-7Z" /></svg>
                            </button>
                            <span class="font-size-indicator">A</span>
                            <button id="increase-font" aria-label="تكبير الخط">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10 5.75a.75.75 0 0 1 .75.75v3h3a.75.75 0 0 1 0 1.5h-3v3a.75.75 0 0 1-1.5 0v-3h-3a.75.75 0 0 1 0-1.5h3v-3A.75.75 0 0 1 10 5.75Z" /></svg>
                            </button>
                        </div>
                    </div>
                    <div class="font-control-group">
                        <span class="font-control-label">نوع الخط</span>
                        <div id="font-selector-wrapper">
                          <button id="font-selector-toggle" aria-label="تغيير الخط">
                            <span>اختر خطاً</span>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" /></svg>
                          </button>
                          <div id="font-selector-popup">
                              <button class="font-option-button" data-font="'Aref Ruqaa', serif" style="font-family: 'Aref Ruqaa', serif;">خط رقاع</button>
                              <button class="font-option-button" data-font="'Cairo', sans-serif" style="font-family: 'Cairo', sans-serif;">خط كايرو</button>
                              <button class="font-option-button" data-font="'Amiri', serif" style="font-family: 'Amiri', serif;">خط أميري</button>
                              <button class="font-option-button" data-font="'Tajawal', sans-serif" style="font-family: 'Tajawal', sans-serif;">خط تجوال</button>
                              <button class="font-option-button" data-font="'Noto Sans Arabic', sans-serif" style="font-family: 'Noto Sans Arabic', sans-serif;">خط نوتو</button>
                          </div>
                        </div>
                    </div>
                </div>
            </div>
           <div class="sidebar-section" id="user-profile-section">
              <p class="history-title">التعرف</p>
              <input type="text" id="user-name-input" placeholder="اكتب اسمك هنا...">
           </div>
           <nav id="chat-history" class="sidebar-section">
            <p class="history-title">السجل</p>
            <div id="history-list-container"></div>
           </nav>
        </div>
      </aside>

      <div id="main-content">
        <div id="app-container">
          <header>
            <button id="menu-toggle" aria-label="فتح القائمة">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 013.75 6h16.5a.75.75 0 010 1.5H3.75A.75.75 0 013 6.75zM3 12a.75.75 0 01.75-.75h16.5a.75.75 0 010 1.5H3.75A.75.75 0 013 12zm0 5.25a.75.75 0 01.75-.75h16.5a.75.75 0 010 1.5H3.75A.75.75 0 01-.75-.75z" clip-rule="evenodd" /></svg>
            </button>
            <div class="header-content">
              <div class="header-text">
                <h1>القيم</h1>
              </div>
            </div>
          </header>
          <main id="chat-container">
            <!-- Messages will be appended here -->
            <div id="welcome-screen">
                <div class="welcome-header">
                    <h1>القيم</h1>
                    <p>السلام عليكم ورحمة الله وبركاته. أنا مساعدك لاستكشاف القيم الإسلامية الأصيلة في ضوء الكتاب والسنة بفهم سلف الأمة. كيف يمكنني مساعدتك اليوم؟</p>
                </div>
                <div class="suggestions">
                    <button class="suggestion-card">ما هو التوحيد وما هي أقسامه؟</button>
                    <button class="suggestion-card">ما حكم ترك الصلاة؟</button>
                    <button class="suggestion-card">اشرح أركان الإيمان</button>
                    <button class="suggestion-card">ما حكم الاحتفال بالمولد النبوي؟</button>
                </div>
            </div>
          </main>
          <footer>
            <form id="chat-form">
                <div class="input-container">
                    <div id="prompt-suggestions-popup">
                        <div class="popup-section">
                           <h3 class="popup-section-title">أسئلة للبدء</h3>
                           <div class="popup-grid grid-cols-2">
                               <button class="popup-suggestion-text-button">ما هو التوحيد وما هي أقسامه؟</button>
                               <button class="popup-suggestion-text-button">ما حكم ترك الصلاة؟</button>
                               <button class="popup-suggestion-text-button">اشرح أركان الإيمان</button>
                               <button class="popup-suggestion-text-button">ما حكم الاحتفال بالمولد النبوي؟</button>
                           </div>
                        </div>
                        <div class="popup-section">
                           <h3 class="popup-section-title">إلهام</h3>
                           <div class="popup-grid grid-cols-3">
                               <button class="popup-suggestion-button">
                                   <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10.75 3.5a.75.75 0 0 0-1.5 0V5h-2a.75.75 0 0 0 0 1.5h2v1.25a.75.75 0 0 0 1.5 0V6.5h2a.75.75 0 0 0 0-1.5h-2V3.5Z" /><path fill-rule="evenodd" d="M3.25 5.5A2.25 2.25 0 0 0 1 7.75v6.5A2.25 2.25 0 0 0 3.25 16.5h13.5A2.25 2.25 0 0 0 19 14.25v-6.5A2.25 2.25 0 0 0 16.75 5.5H3.25Zm1.5 2.75a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 0 1.5H5.5a.75.75 0 0 1-.75-.75Zm.75 3.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5h-6Z" clip-rule="evenodd" /></svg>
                                   <span>قول من اقوال اهل العلم</span>
                               </button>
                               <button class="popup-suggestion-button">
                                   <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm-.75-4.75a.75.75 0 0 0 1.5 0V8.5a.75.75 0 0 0-1.5 0v4.75ZM10 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z" clip-rule="evenodd" /></svg>
                                   <span>انصحني نصيحة</span>
                               </button>
                               <button class="popup-suggestion-button">
                                   <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M3.5 3.75a.25.25 0 0 1 .25-.25h12.5a.25.25 0 0 1 .25.25v12.5a.25.25 0 0 1-.25-.25H3.75a.25.25 0 0 1-.25-.25V3.75ZM4.5 15.5h11V4.5h-11v11Z" /><path d="M6.637 12.043a.75.75 0 0 1 .63.961 3.003 3.003 0 0 0 5.465 0 .75.75 0 1 1 1.26.802 4.503 4.503 0 0 1-8.192 0 .75.75 0 0 1 .837-.961ZM8.5 7.5A.5.5 0 0 1 9 7h2a.5.5 0 0 1 0 1H9a.5.5 0 0 1-.5-.5Z" /></svg>
                                   <span>صورة من قصص الصحابة</span>
                               </button>
                               <button class="popup-suggestion-button">
                                   <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="m3.188 12.143 1.504 1.504a.75.75 0 0 0 1.06 0l2.255-2.254a.75.75 0 1 0-1.06-1.06L5.44 11.84l-1.19-1.19a.75.75 0 0 0-1.062 1.06Z" /><path d="M15.5 3.5a2 2 0 0 0-2-2h-8a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3.5ZM14 16.5H6a.5.5 0 0 1 0-1h8a.5.5 0 0 1 0 1Z" /></svg>
                                   <span>مشهد من سيرة النبي العطرة</span>
                               </button>
                               <button class="popup-suggestion-button">
                                   <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10.868 2.884c.321.023.635.096.932.223l.112.047c.367.155.695.362.98.618l.01.008c.433.385.765.84.99 1.347l.01.022c.33.71.495 1.49.495 2.311V10a7 7 0 1 1-14 0V7.5c0-1.256.333-2.433.918-3.482l.024-.044c.37-.668.86-1.246 1.432-1.724l.04-.033c.365-.307.765-.548 1.18-.72l.048-.02c.42-.173.865-.286 1.324-.335l.092-.008c.327-.023.66-.023 1 0Zm-1.303.665c-.24.01-.475.05-.702.115l-.06.017c-.328.09-.64.23-.926.41l-.034.022c-.4.26-.75.59-1.033.97l-.02.027c-.42.56-.73 1.25-.89 2.01l-.014.065c-.2.9-.3 1.88-.3 2.89V10a6 6 0 1 0 12 0V7.5c0-.77-.15-1.5-.44-2.18l-.01-.023c-.22-.48-.53-.91-.91-1.27l-.01-.008c-.27-.24-.58-.44-.92-.59l-.11-.047c-.28-.12-.58-.19-.88-.21l-.09-.008c-.24-.01-.48-.01-.72 0Z" clip-rule="evenodd" /></svg>
                                   <span>عجائب العُبّاد</span>
                               </button>
                           </div>
                       </div>
                    </div>
                    <button type="button" id="prompt-suggestions-toggle" aria-label="أسئلة مقترحة">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 0 1 1 1v5h5a1 1 0 1 1 0 2h-5v5a1 1 0 1 1-2 0v-5H4a1 1 0 1 1 0-2h5V4a1 1 0 0 1 1-1Z" clip-rule="evenodd" /></svg>
                    </button>
                    <textarea
                        id="chat-input"
                        placeholder="اكتب سؤالك هنا..."
                        aria-label="اكتب سؤالك هنا"
                        rows="1"
                    ></textarea>
                    <button type="submit" aria-label="إرسال">
                        <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                        fill="currentColor"
                        >
                        <path d="M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z" />
                        </svg>
                    </button>
                </div>
            </form>
          </footer>
        </div>
      </div>
    </div>
    
    <!-- Templates for messages -->
    <template id="user-message-template">
      <div class="message-wrapper user-message">
        <div class="message">
          <div class="message-content"></div>
        </div>
      </div>
    </template>

    <template id="ai-message-template">
      <div class="message-wrapper ai-message">
        <div class="message">
          <div class="message-content"></div>
        </div>
        <div class="message-actions">
          <button class="copy-button" aria-label="نسخ النص">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M7 3.5A1.5 1.5 0 0 1 8.5 2h3.879a1.5 1.5 0 0 1 1.06.44l3.122 3.12A1.5 1.5 0 0 1 17 6.622V12.5a1.5 1.5 0 0 1-1.5 1.5h-1v-3.379a1.5 1.5 0 0 0-.44-1.06L9.94 6.439A1.5 1.5 0 0 0 8.5 6.879V14h-1A1.5 1.5 0 0 1 6 12.5v-9z"/><path d="M5 6.5A1.5 1.5 0 0 1 6.5 5h3.879a1.5 1.5 0 0 1 1.06.44l3.122 3.12A1.5 1.5 0 0 1 15 9.622V16.5A1.5 1.5 0 0 1 13.5 18h-7A1.5 1.5 0 0 1 5 16.5v-10z"/></svg>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" style="display: none;"><path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.052-.143Z" clip-rule="evenodd" /></svg>
          </button>
          <div class="share-wrapper">
            <button class="share-button" aria-label="مشاركة">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M13 4.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0ZM8.5 6a3.5 3.5 0 1 0-3.18-5.223.75.75 0 0 1 1.25-.666A5.002 5.002 0 0 1 14.5 6H16a1 1 0 0 1 1 1v1.5a.75.75 0 0 1-1.5 0V8h-1.5A3.5 3.5 0 0 0 8.5 6ZM5 7.5a1 1 0 0 0-1-1H2.5a.75.75 0 0 0 0 1.5H4a1 1 0 0 0 1-1ZM1.13 8.87A.75.75 0 0 1 1.87 8l.223.223A3.5 3.5 0 0 0 5 11.5a.75.75 0 0 1 1.5 0 5.002 5.002 0 0 1-6.223-3.18.75.75 0 0 1 .853-1.077Z" /><path d="m11.166 11.897.108.016a5.002 5.002 0 0 1 4.59 4.31 1.001 1.001 0 0 0 .984.877h.016a1 1 0 0 0 .984-.877 6.502 6.502 0 0 0-6.052-5.63l-.159-.026a.75.75 0 0 0-.74.821l.325 1.523a.75.75 0 0 0 1.438-.306l-.21- .983Z" /></svg>
            </button>
            <div class="share-menu">
              <button class="share-menu-button share-text">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M2 4.75A.75.75 0 0 1 2.75 4h14.5a.75.75 0 0 1 0 1.5H2.75A.75.75 0 0 1 2 4.75ZM2 10a.75.75 0 0 1 .75-.75h14.5a.75.75 0 0 1 0 1.5H2.75A.75.75 0 0 1 2 10Zm0 5.25a.75.75 0 0 1 .75-.75h14.5a.75.75 0 0 1 0 1.5H2.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd" /></svg>
                <span>مشاركة كنص</span>
              </button>
              <button class="share-menu-button share-pdf">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.5 2A1.5 1.5 0 0 0 3 3.5v13A1.5 1.5 0 0 0 4.5 18h11a1.5 1.5 0 0 0 1.5-1.5V7.621a1.5 1.5 0 0 0-.44-1.06l-4.12-4.122A1.5 1.5 0 0 0 11.378 2H4.5ZM10 8a.75.75 0 0 1 .75.75v1.5h1.5a.75.75 0 0 1 0 1.5h-1.5v1.5a.75.75 0 0 1-1.5 0v-1.5h-1.5a.75.75 0 0 1 0-1.5h1.5v-1.5A.75.75 0 0 1 10 8Z" clip-rule="evenodd" /></svg>
                <span>مشاركة كـ PDF</span>
              </button>
              <button class="share-menu-button share-image">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.43 5.342a.75.75 0 0 1 .09 1.056l-2.09 3.032a.75.75 0 0 0 .94.165l2.64-1.467a.75.75 0 0 1 .958.077l2.132 2.132a.75.75 0 0 0 1.06 0l2.228-2.228a.75.75 0 1 0-1.06-1.06l-1.74 1.74-1.64-1.64a2.25 2.25 0 0 0-3.182-.23L7.158 8.45a2.25 2.25 0 0 0-.27 3.12l-1.29 1.87a.75.75 0 0 1-1.11.026l-.002-.002a.75.75 0 0 1 .028-1.11l1.29-1.87a.75.75 0 0 0 .09-.72L4.32 6.4a.75.75 0 0 1 1.056-.09l.86.655.204-.336Z" /><path fill-rule="evenodd" d="M4.5 2A1.5 1.5 0 0 0 3 3.5v13A1.5 1.5 0 0 0 4.5 18h11a1.5 1.5 0 0 0 1.5-1.5V3.5A1.5 1.5 0 0 0 15.5 2h-11ZM4.5 3.5h11V15H8.75a.75.75 0 0 1-.75-.75V9.355a.75.75 0 0 0-1.5 0v4.895A2.25 2.25 0 0 0 8.75 16.5H15.5a.5.5 0 0 1 .5-.5V3.5a.5.5 0 0 0-.5-.5h-11a.5.5 0 0 0-.5.5v12a.5.5 0 0 1-.5.5h-.75a.75.75 0 0 1-.75-.75V3.5Z" clip-rule="evenodd" /></svg>
                <span>مشاركة كصورة</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </template>

    <!-- Delete Confirmation Modal -->
    <div id="delete-confirm-modal" class="modal-overlay">
      <div class="modal-content">
        <h3>تأكيد الحذف</h3>
        <p>هل أنت متأكد من حذف هذه المحادثة؟ لا يمكن التراجع عن هذا الإجراء.</p>
        <div class="modal-actions">
          <button id="cancel-delete-btn" class="modal-button secondary">إلغاء</button>
          <button id="confirm-delete-btn" class="modal-button danger">حذف</button>
        </div>
      </div>
    </div>

    <script type="module" src="index.tsx"></script>
  </body>
</html>